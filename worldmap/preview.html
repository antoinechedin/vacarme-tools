<!DOCTYPE html>
<html style="height: 100%;">

<head>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
</head>

<body style="height: 100%; margin: 0;">
    <div id="map" style="height: 100%;"></div>
    <script>
        let map = L.map('map', { zoomSnap: 1, zoomDelta: 1 });
        L.tileLayer('img/{z}/{y}_{x}.jpg', {
            maxZoom: 7,
        }).addTo(map);

        function rectToCoords(rect) {
            return [[rect[0], [rect[1][0], rect[0][1]], rect[1], [rect[0][0], rect[1][1]], rect[0]]]
        }

        const ZoomViewer = L.Control.extend({
            onAdd() {
                const container = L.DomUtil.create('div');
                container.style.width = '200px';
                container.style.background = 'rgba(255,255,255,0.7)';
                container.style.textAlign = 'left';
                map.on('zoomstart zoom zoomend', (ev) => {
                    container.innerHTML = `Zoom level: ${map.getZoom()}`;
                });
                return container;
            }
        });

        const CoordinatesViewer = L.Control.extend({
            onAdd() {
                const container = L.DomUtil.create('div');
                container.style.width = '200px';
                container.style.background = 'rgba(255,255,255,0.7)';
                container.style.textAlign = 'left';
                map.on('mousemove', (ev) => {
                    container.innerHTML = `Coordinates: [${ev.latlng.lng.toFixed(2)}, ${ev.latlng.lat.toFixed(2)}]`;
                });
                return container
            }
        });

        const zoomViewerControl = (new ZoomViewer()).addTo(map);
        const coordinatesViewerControl = (new CoordinatesViewer()).addTo(map);

        const buttonFeature = [
            {
                type: 'Feature',
                properties: {
                    zoom: 4,
                    url: 'http://89.168.46.40/vacarme/les-royaumes-du-nord/les-comtes-doxhenam/'
                },
                geometry: {
                    type: 'Polygon',
                    coordinates: rectToCoords([[38.0, -15.0], [53.0, -28.0]])
                }
            },
            {
                type: 'Feature',
                properties: {
                    zoom: 6,
                    url: 'http://89.168.46.40/vacarme/deoul-doul/'
                },
                geometry: {
                    type: 'Polygon',
                    coordinates: rectToCoords([[29, -19.0], [33.0, -20.0]])
                }
            }
        ];

        function onEachFeature(feature, layer) {
            if (feature.properties && feature.properties.url) {
                layer.on('click', (ev) => {
                    const link = L.DomUtil.create('a')
                    window.open(feature.properties.url);
                });
            }
        }

        function buttonsStyle(feature) {
            return {
                stroke: false,
                fill: map.getZoom() == feature.properties.zoom
            }
        }

        let buttonsLayer = L.geoJSON(buttonFeature, { style: buttonsStyle, onEachFeature: onEachFeature });
        map.on('zoomend', (ev) => buttonsLayer.resetStyle())
        map.addLayer(buttonsLayer);

        map.setView([0, 0], 2);
    </script>
</body>

</html>